#Changelog:#v3_3: fixed matches per player ala v9. added sortedness to srStats.#v3_2: cleaned up srStats to allow for easier plotting/printing#v3_1: calculating expected scores based on true team ratings to allow for upsets (ala v6)#v3: added ranks to players(:, 4:6)#v2: changed match making to selecting adjacent members of sorted players matrix#This program is to create a simplified simulation of applying Elo rankings#to individuals based on the performance of their team with randomly#matched teammates, akin to Overwatch. Goals are to see how many matches it#takes to get player rankings reasonably close to their "true" rankings.#Assume that every player begins with a true skill rating (srT) that is constant and chosen#from a normal distribution and a measured skill rating (srM) that is initialized#to the mean of the normal dist. Matches are simulated by choosing two teams#of 6 players that are close in srM and then awarding a win to the team with#the greater average srT. Individual ranks are then to be adjusted#based on the average srM difference according to the Elo system.#pseudo-code:#- create matrix with entires for true and measured skill rating of n players#- create true SR entries from a normal dist.#- create measured SR entries equal to the mean of the true rank dist#- select two teams of 6 players#  - select a random "seed" player#  - select another random player and check if their rank within a given range#    of the seed. If they are, put them on one of the teams. If they are not,#    select another random player and repeat.#- Calculate the average srT for each team.#- Let the team with the higher average srT win#  - adjust the individual srM based on the average srM difference#- repeat above stepstic();n = 10000; #number of players in the poolmeanRank = (n+1)/2;matchesPerPlayer = 200; #average number of matches per player to simulateteamSize = 6;matches = round(matchesPerPlayer*n/(2*teamSize)); #number of matches to playave = 1500; #average player srTsd = 350; #std deviation of srTmatchSpread = sd; #largest allowed srM difference from seed playerk=32; #Elo k parameter#players contains: (:,1) srT - true skill rating#players contains: (:,2) srM - meaasured skill rating#players contains: (:,3) srT-srM#players contains: (:,4) rankT - true rank. higher rank = better player#players contains: (:,5) rankM - measured rank#players contains: (:,6) rankT-rankMplayers = zeros(n,6); #srT, srM, srT-srM, rankT, rankM, rankT-rankMplayers(:,1) = normrnd(ave, sd, n,1); #set srTplayers(:,2) = ave; #set initial srMplayers = sortrows(players, 1); #sort by srTplayers(:,4) = [1:n]'; #set rankT#shuffle players so that rankM != rankTshuffleOrder = randperm(n);players=players(shuffleOrder,:);updatePeriod = round(matches/100); #how many matches pass between updating srStats and players(:,3)#srStats contains: (:,1) |sr diff| ave#srStats contains: (:,2) sr diff std dev#srStats contains: (:,3) |rank diff| ave#srStats contains: (:,4) rank diff std dev#srStats contains: (:,5) match number#srStats contains: (:,6) sortednesssrStats = zeros(0,6); #|sr diff| ave, sr diff std dev, |rank diff| ave, rank diff std dev, match number, sortednessfor j = 1:matches    #update stats according to updatePeriod  if ( (mod(j,updatePeriod)==0) || (j==1) )    players(:,5) = [1:n]'; #set rankM for the current stat update    players(:,3) = players(:,1) - players(:,2); #set sr difference    players(:,6) = players(:,4) - players(:,5);# set rank difference        srStatsUpdate = zeros(1,5); #temporary place to store new line before concatenating to srStats    srStatsUpdate(1,1) = mean(abs(players(:,3)));    srStatsUpdate(1,2) = std(players(:,3));    srStatsUpdate(1,3) = mean(abs(players(:,6)));    srStatsUpdate(1,4) = std(players(:,6));    srStatsUpdate(1,5) = j;    ranksT = players(:,4)-meanRank;    ranksM = players(:,5)-meanRank;    srStatsUpdate(1,6) = dot(ranksT, ranksM)/norm(ranksT)^2;        srStats = [srStats; srStatsUpdate]; #tack on new line of stats  endif    match = zeros(teamSize*2,4); #player index, team#, player srT, player srM  picks = 0; #number of players chosen for the current match  teams = zeros(2,4); #mean srT, mean srM, score, expected score  r = zeros(2,2); #rSrT, rSrM: transformed team ratings, for ease of calculations later    #create the match  seed = randi(n-(2*teamSize-1));  for i = 1:2*teamSize    match(i,:) = [seed + i-1, mod(i-1,2)+1, players(seed + i-1, 1:2)];  endfor    #determine team ratings  match = sortrows(match,2); #sort by team #  teams(1,1:2) = mean(match(1:teamSize, 3:4));; #srT and srM for team 1  teams(2,1:2) = mean(match(teamSize+1:teamSize*2, 3:4)); # " " team 2  #calculate transformed team ratings (true and measured)  r(1,1) = 10^(teams(1,1)/400);  r(2,1) = 10^(teams(2,1)/400);  r(1,2) = 10^(teams(1,2)/400);  r(2,2) = 10^(teams(2,2)/400);  #calculate real score for each team  teams(1,3) = r(1,1)/(r(1,1)+r(2,1));  teams(2,3) = r(2,1)/(r(1,1)+r(2,1));  #assign score of 1 to the winning team based on real score  if (teams(1,3) > rand())    teams(1,3) = 1;    teams(2,3) = 0;    else    teams(1,3) = 0;    teams(2,3) = 1;  endif  #calculate expected score for each team  teams(1,4) = r(1,2)/(r(1,2)+r(2,2));  teams(2,4) = r(2,2)/(r(1,2)+r(2,2));  #update Elo ratings for each player that was in the match  for i=1:size(match,1)    players(match(i,1),2) = players(match(i,1),2) + k * (teams(match(i,2),3) - teams(match(i,2),4));  endfor  #sort players by srM to prepare for next matchmaking  players = sortrows(players,2);    endforprintf(num2str(toc()));printf("\n");